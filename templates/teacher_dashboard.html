<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - FaceAttendance</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        /* Mobile Sidebar Toggle */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 20px;
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .sidebar.mobile-visible {
            transform: translateX(0);
            transition: transform 0.3s ease;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar-brand-icon {
            font-size: 32px;
            background: rgba(255, 255, 255, 0.2);
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-brand-text h5 {
            margin: 0;
            font-weight: 700;
            font-size: 16px;
        }

        .sidebar-brand-text p {
            margin: 0;
            font-size: 12px;
            opacity: 0.8;
        }

        .sidebar-menu {
            list-style: none;
            margin-bottom: 30px;
        }

        .sidebar-menu-item {
            margin-bottom: 8px;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .sidebar-menu-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }

        .sidebar-menu-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .sidebar-menu-link i {
            width: 20px;
            text-align: center;
        }

        .sidebar-user {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar-user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .sidebar-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .sidebar-user-info h6 {
            margin: 0;
            font-size: 13px;
            font-weight: 600;
        }

        .sidebar-user-info p {
            margin: 0;
            font-size: 11px;
            opacity: 0.8;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 30px;
        }

        /* Header */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 32px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }

        .header-left p {
            color: #666;
            margin: 5px 0 0 0;
            font-size: 14px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .date-picker {
            padding: 10px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .date-picker:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-card-title {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .stat-card-icon {
            font-size: 28px;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .stat-card-icon.cyan {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
        }

        .stat-card-icon.red {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .stat-card-icon.blue {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card-icon.yellow {
            background: linear-gradient(135deg, #ffd93d 0%, #ffb700 100%);
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .stat-card-change {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-card-change.positive {
            color: #00c853;
        }

        .stat-card-change.negative {
            color: #ff6b6b;
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .chart-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .chart-dropdown {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            color: #666;
            cursor: pointer;
            background: white;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Classrooms Section */
        .classrooms-section {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .classrooms-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .classrooms-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .btn-create {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .classroom-list {
            display: grid;
            gap: 16px;
        }

        .classroom-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .classroom-item:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.02);
        }

        .classroom-info h6 {
            margin: 0 0 4px 0;
            font-weight: 600;
            color: #1a1a1a;
        }

        .classroom-info p {
            margin: 0;
            font-size: 13px;
            color: #666;
        }

        .classroom-actions {
            display: flex;
            gap: 8px;
        }

        .btn-action {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: #667eea;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-action:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            color: #667eea;
        }

        .btn-action.danger {
            color: #ff6b6b;
            border-color: #ff6b6b;
        }

        .btn-action.danger:hover {
            background: rgba(255, 107, 107, 0.1);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }

            .main-content {
                margin-left: 240px;
                padding: 20px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar-toggle {
                display: block;
            }

            .sidebar {
                width: 100%;
                height: 100vh;
                position: fixed;
                top: 0;
                left: 0;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                padding: 20px;
                overflow-y: auto;
                z-index: 1000;
            }

            .sidebar.mobile-visible {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
                padding-top: 70px;
            }

            .sidebar-user {
                position: relative;
                bottom: auto;
                left: auto;
                right: auto;
                margin-top: 20px;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                margin-bottom: 20px;
            }

            .header-left h1 {
                font-size: 24px;
            }

            .header-left p {
                font-size: 12px;
            }

            .header-right {
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }

            .date-picker {
                width: 100%;
                padding: 8px 12px;
                font-size: 13px;
            }

            .user-profile {
                width: 100%;
                justify-content: space-between;
            }

            .user-name {
                font-size: 12px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-card-value {
                font-size: 24px;
            }

            .stat-card-title {
                font-size: 12px;
            }

            .stat-card-icon {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .chart-card {
                padding: 16px;
            }

            .chart-card-title {
                font-size: 16px;
            }

            .chart-container {
                height: 250px;
            }

            .chart-dropdown {
                padding: 6px 10px;
                font-size: 12px;
            }

            .classrooms-section {
                padding: 16px;
            }

            .classrooms-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .classrooms-title {
                font-size: 16px;
            }

            .btn-create {
                width: 100%;
                padding: 10px 16px;
                font-size: 14px;
                justify-content: center;
            }

            .classroom-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
                padding: 12px;
            }

            .classroom-info h6 {
                font-size: 14px;
            }

            .classroom-info p {
                font-size: 12px;
            }

            .classroom-actions {
                width: 100%;
                flex-wrap: wrap;
                gap: 6px;
            }

            .btn-action {
                padding: 6px 10px;
                font-size: 12px;
                flex: 1;
                min-width: 70px;
                justify-content: center;
            }

            .btn-action i {
                display: none;
            }

            .empty-state {
                padding: 30px 15px;
            }

            .empty-state i {
                font-size: 36px;
            }

            .empty-state p {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 12px;
                padding-top: 60px;
            }

            .header-left h1 {
                font-size: 20px;
            }

            .stat-card {
                padding: 12px;
            }

            .stat-card-value {
                font-size: 20px;
            }

            .chart-container {
                height: 200px;
            }

            .classroom-item {
                padding: 10px;
            }

            .btn-action {
                padding: 5px 8px;
                font-size: 11px;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            margin: 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- Mobile Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-brand">
                <div class="sidebar-brand-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <div class="sidebar-brand-text">
                    <h5>FaceAttendance</h5>
                    <p>Teacher Dashboard</p>
                </div>
            </div>

            <ul class="sidebar-menu">
                <li class="sidebar-menu-item">
                    <a href="{{ url_for('teacher_dashboard', tab='overview') }}" class="sidebar-menu-link {% if active_tab == 'overview' %}active{% endif %}">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="{{ url_for('teacher_dashboard', tab='students') }}" class="sidebar-menu-link {% if active_tab == 'students' %}active{% endif %}">
                        <i class="fas fa-users"></i>
                        <span>Students</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="{{ url_for('teacher_dashboard', tab='attendance') }}" class="sidebar-menu-link {% if active_tab == 'attendance' %}active{% endif %}">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Attendance</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="{{ url_for('teacher_dashboard', tab='analytics') }}" class="sidebar-menu-link {% if active_tab == 'analytics' %}active{% endif %}">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="{{ url_for('teacher_dashboard', tab='notifications') }}" class="sidebar-menu-link {% if active_tab == 'notifications' %}active{% endif %}">
                        <i class="fas fa-bell"></i>
                        <span>Notifications</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="{{ url_for('profile') }}" class="sidebar-menu-link">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </li>
                <li class="sidebar-menu-item">
                    <a href="#" class="sidebar-menu-link" data-bs-toggle="modal" data-bs-target="#helpModal">
                        <i class="fas fa-question-circle"></i>
                        <span>Help & Support</span>
                    </a>
                </li>
            </ul>

            <div class="sidebar-user">
                <div class="sidebar-user-profile" data-bs-toggle="modal" data-bs-target="#profileModal" style="cursor: pointer; transition: all 0.3s ease;">
                    <div class="sidebar-user-avatar" style="overflow: hidden;">
                        {% if session.get('profile_image') %}
                            <img src="{{ url_for('static', filename=session.profile_image) }}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'">
                        {% endif %}
                        <i class="fas fa-user" style="{% if session.get('profile_image') %}display: none;{% endif %}"></i>
                    </div>
                    <div class="sidebar-user-info">
                        <h6>{{ session.full_name }}</h6>
                        <p>Computer Science Dept.</p>
                    </div>
                </div>
            </div>

            <!-- Theme Toggle & Logout -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.2); display: flex; flex-direction: column; gap: 10px;">
                <button id="themeToggle" class="sidebar-menu-link" style="width: 100%; justify-content: center;">
                    <i class="fas fa-moon"></i>
                    <span>Dark Mode</span>
                </button>
                <a href="{{ url_for('logout') }}" class="sidebar-menu-link" style="width: 100%; justify-content: center; background: rgba(255, 107, 107, 0.2); color: #ffcccc;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="dashboard-header">
                <div class="header-left">
                    <h1>Teacher Dashboard</h1>
                    <p>Welcome back! Here's your daily overview</p>
                </div>
                <div class="header-right">
                    <input type="date" class="date-picker" id="dateFilter" value="{{ today }}">
                    <div class="user-profile">
                        <div class="user-avatar">{{ session.full_name[0] }}</div>
                        <div class="user-name">{{ session.full_name }}</div>
                    </div>
                </div>
            </div>

            <!-- Overview Tab -->
            {% if active_tab == 'overview' %}
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">Students Present Today</div>
                        <div class="stat-card-icon cyan">
                            <i class="fas fa-user-check"></i>
                        </div>
                    </div>
                    <div class="stat-card-value" id="presentCount">0</div>
                    <div class="stat-card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+12% from yesterday</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">Students Absent</div>
                        <div class="stat-card-icon red">
                            <i class="fas fa-user-times"></i>
                        </div>
                    </div>
                    <div class="stat-card-value" id="absentCount">0</div>
                    <div class="stat-card-change negative">
                        <i class="fas fa-arrow-down"></i>
                        <span>-2 from yesterday</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">Overall Attendance</div>
                        <div class="stat-card-icon blue">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                    </div>
                    <div class="stat-card-value" id="attendancePercentage">92%</div>
                    <div class="stat-card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+3% this week</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">Classes This Week</div>
                        <div class="stat-card-icon yellow">
                            <i class="fas fa-book"></i>
                        </div>
                    </div>
                    <div class="stat-card-value">{{ classrooms|length }}</div>
                    <div class="stat-card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+2 classes completed</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-card-title">Weekly Attendance Trend</div>
                        <select class="chart-dropdown" id="weekFilter">
                            <option>This Week</option>
                            <option>Last Week</option>
                            <option>This Month</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-card-title">Class-wise Distribution</div>
                        <select class="chart-dropdown" id="classFilter">
                            <option>All Classes</option>
                            {% for classroom in classrooms %}
                            <option value="{{ classroom.id }}">{{ classroom.class_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="classDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Classrooms Section -->
            <div class="classrooms-section">
                <div class="classrooms-header">
                    <div class="classrooms-title">My Classrooms</div>
                    <a href="{{ url_for('create_classroom') }}" class="btn-create">
                        <i class="fas fa-plus"></i>
                        <span>Create Classroom</span>
                    </a>
                </div>

                {% if classrooms %}
                <div class="classroom-list">
                    {% for classroom in classrooms %}
                    <div class="classroom-item">
                        <div class="classroom-info">
                            <h6>{{ classroom.class_name }}</h6>
                            <p>
                                <strong>Code:</strong> {{ classroom.class_code }} • 
                                <strong>Students:</strong> {{ classroom.student_count or 0 }} • 
                                <strong>Schedule:</strong> {{ classroom.schedule_time or 'Not set' }}
                            </p>
                        </div>
                        <div class="classroom-actions">
                            <a href="{{ url_for('view_attendance', classroom_id=classroom.id) }}" class="btn-action">
                                <i class="fas fa-eye"></i> View
                            </a>
                            <a href="{{ url_for('manage_attendance', classroom_id=classroom.id) }}" class="btn-action">
                                <i class="fas fa-edit"></i> Manage
                            </a>
                            <a href="{{ url_for('classroom_events', classroom_id=classroom.id) }}" class="btn-action" title="Manage Events">
                                <i class="fas fa-calendar-alt"></i> Events
                            </a>
                            <a href="{{ url_for('qr_code', classroom_id=classroom.id) }}" class="btn-action" title="Generate QR Code">
                                <i class="fas fa-qrcode"></i> QR Code
                            </a>
                            <a href="{{ url_for('download_attendance', classroom_id=classroom.id) }}" class="btn-action">
                                <i class="fas fa-download"></i> Export
                            </a>
                            <button class="btn-action danger" onclick="deleteClassroom({{ classroom.id }})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>No classrooms yet. Create one to get started!</p>
                </div>
                {% endif %}
            </div>

            {% elif active_tab == 'students' %}
            <div class="classrooms-section">
                <div class="classrooms-header">
                    <div class="classrooms-title">Students Management</div>
                </div>
                {% if classrooms %}
                <div class="classroom-list">
                    {% for classroom in classrooms %}
                    <div class="classroom-item">
                        <div class="classroom-info">
                            <h6>{{ classroom.class_name }}</h6>
                            <p>
                                <strong>Code:</strong> {{ classroom.class_code }} • 
                                <strong>Students Enrolled:</strong> {{ classroom.student_count or 0 }}
                            </p>
                        </div>
                        <div class="classroom-actions">
                            <a href="{{ url_for('manage_attendance', classroom_id=classroom.id) }}" class="btn-action">
                                <i class="fas fa-users-cog"></i> Manage Students
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-users"></i>
                    <p>No classrooms found. Create one first!</p>
                </div>
                {% endif %}
            </div>

            {% elif active_tab == 'attendance' %}
            <div class="classrooms-section">
                <div class="classrooms-header">
                    <div class="classrooms-title">Attendance Management</div>
                </div>
                {% if recent_attendance %}
                <div class="classroom-list">
                    {% for item in recent_attendance %}
                    <div class="classroom-item">
                        <div class="classroom-info">
                            <h6>{{ item.student_name }}</h6>
                            <p>
                                <strong>Class:</strong> {{ item.class_name }} • 
                                <strong>Date:</strong> {{ item.date }} • 
                                <strong>Time:</strong> {{ item.marked_at }}
                            </p>
                        </div>
                        <div class="classroom-actions">
                            {% if item.status == 'P' %}
                            <span style="padding: 8px 12px; background: #d4edda; color: #155724; border-radius: 6px; font-size: 13px; font-weight: 500;">
                                <i class="fas fa-check-circle"></i> Present
                            </span>
                            {% elif item.status == 'A' %}
                            <span style="padding: 8px 12px; background: #f8d7da; color: #721c24; border-radius: 6px; font-size: 13px; font-weight: 500;">
                                <i class="fas fa-times-circle"></i> Absent
                            </span>
                            {% else %}
                            <span style="padding: 8px 12px; background: #e2e3e5; color: #383d41; border-radius: 6px; font-size: 13px; font-weight: 500;">
                                {{ item.status }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-clipboard-check"></i>
                    <p>No attendance records yet.</p>
                </div>
                {% endif %}
            </div>

            {% elif active_tab == 'analytics' %}
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-card-title">Monthly Attendance Trend</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-card-title">Attendance Distribution</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>

            {% elif active_tab == 'notifications' %}
            <div class="classrooms-section">
                <div class="classrooms-header">
                    <div class="classrooms-title">Notifications</div>
                </div>
                <div class="empty-state">
                    <i class="fas fa-bell"></i>
                    <p>No new notifications at this time.</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Set today's date
        document.getElementById('dateFilter').valueAsDate = new Date();

        // Initialize Charts
        function initCharts() {
            // Weekly Attendance Chart
            const attendanceCtx = document.getElementById('attendanceChart');
            if (attendanceCtx) {
                new Chart(attendanceCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                        datasets: [
                            {
                                label: 'Present Students',
                                data: [140, 145, 140, 145, 150, 140],
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 5,
                                pointBackgroundColor: '#667eea',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'Absent Students',
                                data: [15, 12, 18, 10, 8, 15],
                                borderColor: '#ff6b6b',
                                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 5,
                                pointBackgroundColor: '#ff6b6b',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        }
                    }
                });
            }

            // Class Distribution Chart
            const classCtx = document.getElementById('classDistributionChart');
            if (classCtx) {
                new Chart(classCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['CS-301', 'CS-302', 'CS-303', 'Math-201', 'Physics-101'],
                        datasets: [{
                            data: [30, 25, 20, 15, 10],
                            backgroundColor: [
                                '#667eea',
                                '#764ba2',
                                '#00d4ff',
                                '#ffd93d',
                                '#ff6b6b'
                            ],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }

            // Monthly Chart
            const monthlyCtx = document.getElementById('monthlyChart');
            if (monthlyCtx) {
                new Chart(monthlyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Attendance %',
                            data: [92, 88, 95, 90],
                            backgroundColor: '#667eea',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            // Distribution Chart
            const distCtx = document.getElementById('distributionChart');
            if (distCtx) {
                new Chart(distCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Present', 'Absent', 'Leave'],
                        datasets: [{
                            data: [85, 10, 5],
                            backgroundColor: ['#00c853', '#ff6b6b', '#ffd93d'],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        // Delete Classroom
        function deleteClassroom(classroomId) {
            if (confirm('Are you sure you want to delete this classroom? This action cannot be undone.')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/delete_classroom/${classroomId}`;
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initCharts);

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;
        
        // Load theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            htmlElement.setAttribute('data-bs-theme', 'dark');
            document.body.style.background = '#1a1a1a';
            themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
        }

        themeToggle.addEventListener('click', function() {
            const currentTheme = htmlElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            htmlElement.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            if (newTheme === 'dark') {
                document.body.style.background = '#1a1a1a';
                themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
            } else {
                document.body.style.background = '#f5f7fa';
                themeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
            }
        });
    </script>

    <!-- Help & Support Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                    <h5 class="modal-title" id="helpModalLabel">
                        <i class="fas fa-headset me-2"></i>Help & Support
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <i class="fas fa-phone-alt" style="font-size: 48px; color: #667eea; margin-bottom: 15px; display: block;"></i>
                        <h6 style="margin-bottom: 5px; font-weight: 600;">Contact Support Team</h6>
                        <p style="color: #666; margin: 0;">We're here to help you 24/7</p>
                    </div>

                    <div style="background: #f5f7fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <p style="margin: 0; font-weight: 600; color: #1a1a1a;">Phone Support</p>
                                <p style="margin: 5px 0 0 0; color: #667eea; font-weight: 500;">+1 (800) 123-4567</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: #00d4ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div>
                                <p style="margin: 0; font-weight: 600; color: #1a1a1a;">Email Support</p>
                                <p style="margin: 5px 0 0 0; color: #667eea; font-weight: 500;">support@faceattendance.com</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div>
                                <p style="margin: 0; font-weight: 600; color: #1a1a1a;">Live Chat</p>
                                <p style="margin: 5px 0 0 0; color: #667eea; font-weight: 500;">Available Mon-Fri, 9AM-6PM</p>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 40px; height: 40px; background: #ffd93d; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div>
                                <p style="margin: 0; font-weight: 600; color: #1a1a1a;">Office Address</p>
                                <p style="margin: 5px 0 0 0; color: #667eea; font-weight: 500;">123 Tech Street, Silicon Valley, CA</p>
                            </div>
                        </div>
                    </div>

                    <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; border-left: 4px solid #00d4ff;">
                        <p style="margin: 0; font-size: 13px; color: #0066cc;">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Response Time:</strong> We typically respond within 2 hours during business hours.
                        </p>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #e0e0e0;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="mailto:support@faceattendance.com" class="btn btn-primary">
                        <i class="fas fa-envelope me-2"></i>Send Email
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                    <h5 class="modal-title" id="profileModalLabel">
                        <i class="fas fa-user-circle me-2"></i>Profile Settings
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <form id="profileForm" method="POST" action="{{ url_for('profile') }}" enctype="multipart/form-data">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <div id="profilePreview" style="width: 100px; height: 100px; margin: 0 auto 15px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 40px; overflow: hidden;">
                                {% if session.profile_image %}
                                    <img src="{{ url_for('static', filename=session.profile_image) }}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                    <i class="fas fa-user"></i>
                                {% endif %}
                            </div>
                            <input type="file" id="profileImageInput" name="profile_image" accept="image/*" style="display: none;">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="document.getElementById('profileImageInput').click();">
                                <i class="fas fa-camera me-2"></i>Change Photo
                            </button>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" name="full_name" value="{{ session.full_name }}" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" placeholder="your@email.com">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" name="phone" placeholder="+1 (555) 123-4567">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Register Face for Login</label>
                            <div style="display: flex; gap: 10px;">
                                <a href="{{ url_for('capture_face', next=url_for('teacher_dashboard')) }}" class="btn btn-primary flex-grow-1">
                                    <i class="fas fa-camera me-2"></i>Register Face
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #e0e0e0;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="document.getElementById('profileForm').submit();">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Profile image preview
        document.getElementById('profileImageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('profilePreview').innerHTML = `<img src="${event.target.result}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover;">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Mobile Sidebar Toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.querySelector('.sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('mobile-visible');
            sidebar.classList.toggle('mobile-hidden');
            sidebarOverlay.classList.toggle('active');
        });

        sidebarOverlay.addEventListener('click', function() {
            sidebar.classList.remove('mobile-visible');
            sidebar.classList.add('mobile-hidden');
            sidebarOverlay.classList.remove('active');
        });

        // Close sidebar when clicking on a menu item (mobile)
        if (window.innerWidth <= 768) {
            const menuLinks = document.querySelectorAll('.sidebar-menu-link');
            menuLinks.forEach(link => {
                link.addEventListener('click', function() {
                    sidebar.classList.remove('mobile-visible');
                    sidebar.classList.add('mobile-hidden');
                    sidebarOverlay.classList.remove('active');
                });
            });
        }
    </script>
</body>
</html>
